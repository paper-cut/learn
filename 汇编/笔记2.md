# 寄存器(cpu工作原理)

CPU由控制器、运算器、寄存器等器件构成，在CPU内部这些器件由内部总线相连

8086CPU共有14个寄存器，他们的名称分别为：AX、BX、CX、DX、SI、DI、SP、BP、IP、CS、SS、DS、ES、PSW。

从8086往后的CPU的构架基本都和8086类似

其中有八个通用寄存器

## 通用寄存器

8086寄存器都是16位的，可以存放两个字节。

每个寄存器可以存储的最高数值位为2的16次方减一。为了兼容，每个寄存器也可以当成两个独立的8位寄存器使用。

AX、BX、CX、DX通常用来存放一些一般性数据，被称为通用寄存器

### 以AX寄存器为例

AX可以分为AH（高八位8~15）、AL（低八位0~7）两个独立的八位寄存器

## 字在寄存器中的存储

一个字可以存储在16位寄存器中，占两个字节

### 关于数制的讨论

由于16进制和2进制之间的转换十分方便，所以汇编中对于程序员来说16进制更直观观看

16进制数便是的数据可以更加直观的观看

## 几条汇编指令

汇编指令不区分大小写

mov ax,18:将18送入ax中

add ax,8:将寄存器AX中的数值家上8

mov ax,bx:将寄存器BX中的内容送入寄存器AX中

add ax,bx:将AX中的内容和BX中的内容相加，结果存入AX中

## 物理地址

CPU访问内存单元时要给出内存单元的地址。所有的内存单元构成的存储空间是一个一维的线性空间

我们将这个唯一的地址称为物理地址

## 16位结构的CPU

概括的讲，16位结构描述了一个CPU具有以下几个方面的特征

<ul>
<li>运算器一次最多可以处理16位的数据
<li>寄存器的最大宽度为16位
<li>寄存器和运算器之间的通路是16位的
</ul>

## 8086CPU给出物理地址的方法

8086CPU有20位的地址总线，但是他的内部是16位的结构，那么内外部的寻址是如何协调的呢？

答：8086CPU采用两个16位的地址（段地址、偏离地址），在地址加法器中用段地址*16+偏离地址，就得到了20位的物理地址。

原理：由于说，2进制的16位数*16之后，就变成了20位数，相当于左移4位

## 段的概念

段的划分来自CPU，由于8086CPU使用“（段地址*16）+偏移地址=物理地址”的方式给出内存单元的物理地址，使得我们可以用分段的方式来管理内存

在编程时可以根据需要，将若干地址连续的内存单元看作一个段，用段地址*16定位段的起始地址，用偏移地址定位段中的内存单元

### 两点注意

1.段地址*16必然是16的倍数，所以一个段的起始地址也一定是16的倍数

2.偏移地址为16位，16位地址的寻址能力为64K，所以一个段的长度最大为64K

### 内存地址单元小结

一个物理地址可以由不同的段地址和偏移地址组成

给定段地址，段内的寻址范围由偏移地址决定

## 段寄存器

段寄存器即提供段地址的寄存器

8086CPU中有4个段寄存器:CS、DS、SS、ES

当8086CPU需要访问内存时，这四个段寄存器提供内存单元的段地址

## CS和IP

CS和IP时8086中最关键的寄存，他们指示了CPU当前要读取指令的地址

CS为代码段寄存器
IP为指令指针寄存器

### 8086PC工作过程简要描述

1.从CS:IP指向内存单元读取指令，读取的指令进入指令缓存器

2.IP=IP+所读取指令的长度，从而指向下一条指令

3.执行指令，转到步骤（1）重复这个过程

在8086CPU加点启动或者复位后，CS和IP被设置为CS=FFFFH，IP=0000H
即在8086CPU刚启动时，CPU从内存FFFF0H单元中读取指令执行
FFFF0H单元中的指令是8086PC机开机后执行的第一条指令

任何时候，CS和IP组成的物理地址会被CPU到内存中读取指令

#### 修改CS、IP指令

在CPU中，程序员可以通过修改寄存器中的内容实现对CPU的控制。
则程序员可以通过改变CS、IP中的内容来控制CPU执行目标指令。

我们如何改变CS、IP的值呢？

mov指令不可以用来修改

可以使用JMP 转移指令来修改

同时修改CS、IP的内容
jmp 段地址:偏移地址

例如： jmp 2AE3:3

这样就可以修改CS和IP中的内容

仅修改IP的话就是 jmp 某一合法寄存器。
例如：jmp ax。
即用寄存器中的值修改IP

### 代码段

对8086PC机，可以将长度为N（N<=64KB）的一组代码，存在一组地址连续、起始位置为16的倍数的内存单元中，这段内存是用来存放代码的，从而定义了一个代码段

### 小结

在8086CPU中，任意时刻，CPU将CS：IP指向的内容当作指令执行

# 实验1 查看CPU和内存，用机器指令和汇编指令编程


# DUBUG

R命令：查看、改变CPU寄存器中的内容
D命令查看内存中的内容
E命令改写内存中的内容
U命令将内存中的机器指令翻译为汇编指令
T命令执行一条机器指令
A命令以汇编指令的格式在内存中写入一条机器指令


